#!/bin/sh
TERMINAL="${TERMINAL:-st}"
EDITOR="${EDITOR:-nvim}"
STATUSBAR="${STATUSBAR:-dwmblocks}"
# Fetch the current volume state and mute status in one go
amixer_output=$(amixer get Master)
# Handle button actions
case "$BLOCK_BUTTON" in
1) setsid -w -f "$TERMINAL" -e alsamixer ;;
2) amixer set Master toggle ;;
4) amixer set Master 2%+ ;;
5) amixer set Master 2%- ;;
3) notify-send "ðŸ“¢ Volume module" "\- Shows volume ðŸ”Š, ðŸ”‡ if muted.\n- Middle click to mute.\n- Scroll to change." ;;
6) setsid -f "$TERMINAL" -e "$EDITOR" "$0" ;;
esac
# Check mute status once and set volume icon accordingly
if [[ "$amixer_output" == *"[off]"* ]]; then
echo "ðŸ”‡"
else
# Extract the volume percentage more efficiently
vol=$(echo "$amixer_output" | grep -oP '\d+(?=%)' | head -n1)
# Determine icon based on volume level
if (( vol >= 70 )); then
icon="ðŸ”Š"
elif (( vol >= 30 )); then
icon="ðŸ”‰"
elif (( vol > 0 )); then
icon="ðŸ”ˆ"
else
icon="ðŸ”‡"
fi
echo "$icon$vol%"
fi
# Refresh the status bar

pkill -RTMIN+10 "$STATUSBAR"
